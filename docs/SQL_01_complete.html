<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SQL: Introduction to Queries</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="SQL_01_complete_files/libs/clipboard/clipboard.min.js"></script>
<script src="SQL_01_complete_files/libs/quarto-html/quarto.js"></script>
<script src="SQL_01_complete_files/libs/quarto-html/popper.min.js"></script>
<script src="SQL_01_complete_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SQL_01_complete_files/libs/quarto-html/anchor.min.js"></script>
<link href="SQL_01_complete_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SQL_01_complete_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SQL_01_complete_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SQL_01_complete_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SQL_01_complete_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SQL: Introduction to Queries</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>SQL (<strong>S</strong>tructured <strong>Q</strong>uery <strong>L</strong>anguage) is a set of rules that define the syntax used to build, update, query, and manage a relational database. Many different software packages that offer relational database capabilities follow these rules. In computer science terms, SQL is a <em>specification</em> that defines a set of standards, and the software packages are <em>implementations</em> of those standards.</p>
<p>For class, we will be using <strong>SQLite</strong>, which claims to be the most widely used implementations of the SQL standard. Many applications on your computer, phone, and perhaps your watch, use SQLite to manage calendars, playlists, contacts, to-do items, shopping carts, and much more. You can learn about some of the many deployments of SQLite <a href="https://www.sqlite.org/famous.html">here</a>.</p>
<p>SQLite is also a popular implementation for learning SQL, because it simplifies many of the technical details involved in setting up a relational database. If you decide to use relational databases in your future research, you may want to use a more powerful implementation, such as <strong>PostgreSQL</strong> or <strong>DuckDB</strong>. Both are open-source and free; PostgreSQL is widely implemented in research and commercial settings, while DuckDB is a newer implementation designed specifically for data science. Both are more scalable, flexible, and powerful than SQLite; however, this comes with added complexity in setting up a database.</p>
<p>For the SQL class sessions, we will work with field observations. This will allow us to bring in some new data types, including dates and geolocations, that we can explore later with R. The relational database we will be working with is Greg’s birding observations. See the slide deck for information about the tables, their contents, and their relations.</p>
</section>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set-up</h2>
<p>To use SQLite within a Quarto notebook, you will first need to install two packages: <strong>RSQLite</strong>, an implementation of SQL for R, and <strong>DBI</strong>, which provides interfaces to many different implementations of SQL. Make sure you install both packages before proceeding (as usual, code for installing packages is not included in the notebook).</p>
<p>The following code block sets up your RStudio environment to work with SQLite. After loading the necessry libraries, the next step is to establish a connection to the database. SQL offers the option of a very simple in-memory database that we can automatically build just by importing data in <code>.csv</code> format. Line 26 creates a connection object that allows us to read and write to the database. Finally, line 29 provides the rendering process with access to that connection.</p>
</section>
<section id="build-the-database" class="level2">
<h2 class="anchored" data-anchor-id="build-the-database">Build the database</h2>
<p>Now we’re ready to read in the data that will make up the relational database. Make sure you have all 7 <code>s_*.csv</code> files in your working directory: species, genera, families, orders, trips, locations, countries, and observations.</p>
<p>The following code imports data from the 7 <code>.csv</code> files into SQL tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read tables into objects and convert to SQL tables</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     observations table</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>observations <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"s_observations.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>observations<span class="sc">$</span>date_obs <span class="ot">&lt;-</span> <span class="fu">as.character</span>(observations<span class="sc">$</span>date_obs)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">copy_to</span>(<span class="at">dest =</span> con, <span class="at">df =</span> observations, <span class="at">name =</span> <span class="st">"observations"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     locations table</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>locations <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"s_locations.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>locations<span class="sc">$</span>earliest <span class="ot">&lt;-</span> <span class="fu">as.character</span>(locations<span class="sc">$</span>earliest)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>locations<span class="sc">$</span>latest <span class="ot">&lt;-</span> <span class="fu">as.character</span>(locations<span class="sc">$</span>latest)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">copy_to</span>(<span class="at">dest =</span> con, <span class="at">df =</span> locations, <span class="at">name =</span> <span class="st">"locations"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     trips table</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>trips <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"s_trips.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>trips<span class="sc">$</span>start_date <span class="ot">&lt;-</span> <span class="fu">as.character</span>(trips<span class="sc">$</span>start_date)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>trips<span class="sc">$</span>end_date <span class="ot">&lt;-</span> <span class="fu">as.character</span>(trips<span class="sc">$</span>end_date)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">copy_to</span>(<span class="at">dest =</span> con, <span class="at">df =</span> trips, <span class="at">name =</span> <span class="st">"trips"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     species table</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"s_species.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">copy_to</span>(<span class="at">dest =</span> con, <span class="at">df =</span> species, <span class="at">name =</span> <span class="st">"species"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     genera table</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>genera <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"s_genera.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">copy_to</span>(<span class="at">dest =</span> con, <span class="at">df =</span> genera, <span class="at">name =</span> <span class="st">"genera"</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     families table</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>families <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"s_families.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">copy_to</span>(<span class="at">dest =</span> con, <span class="at">df =</span> families, <span class="at">name =</span> <span class="st">"families"</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     orders table</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>orders <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"s_orders.csv"</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">copy_to</span>(<span class="at">dest =</span> con, <span class="at">df =</span> orders, <span class="at">name =</span> <span class="st">"orders"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With SQLite, you can simply work with these tables in memory after they have been imported. We will consider how to store the database in files on disk later.</p>
</section>
<section id="simple-queries" class="level2">
<h2 class="anchored" data-anchor-id="simple-queries">Simple queries</h2>
<p><code>SELECT</code> is the workhorse of data retrieval in SQL. It can be used in simple constructions with a single table or in complex statements that involve grouping, summaries, aliases, functions, nested queries, and joins between multiple tables. We will start by working with data in a single table to introduce basic filtering and output capabilities.</p>
<p>Every <code>SELECT</code> statement includes two components: the column(s) to return and the table(s) to work with. The simplest possible <code>SELECT</code> statement is shown below. The <code>*</code> character means return all columns. The <code>FROM</code> clause tells SQL which table you want to work with.</p>
<p><strong>All rows, all columns.</strong> The default behavior of <code>SELECT</code> is to return all rows unless you tell it otherwise. Thus, this query returns all of the data in the <code>orders</code> table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return all data from orders table</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> orders; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 4%">
<col style="width: 22%">
<col style="width: 51%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">order_ioc</th>
<th style="text-align: right;">seq</th>
<th style="text-align: left;">familiar_ioc</th>
<th style="text-align: left;">taxonomy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Struthioniformes</td>
<td style="text-align: right;">101</td>
<td style="text-align: left;">Ostriches</td>
<td style="text-align: left;">EC; in Paleognathae; ditypic</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rheiformes</td>
<td style="text-align: right;">103</td>
<td style="text-align: left;">Rheas</td>
<td style="text-align: left;">EC; in Paleognathae; ditypic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apterygiformes</td>
<td style="text-align: right;">105</td>
<td style="text-align: left;">Kiwis</td>
<td style="text-align: left;">EC; in Paleognathae; sister to Casuariformes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Casuariiformes</td>
<td style="text-align: right;">107</td>
<td style="text-align: left;">Cassowaries and Emu</td>
<td style="text-align: left;">EC; in Paleognathae; sister to Apterygiformes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tinamiformes</td>
<td style="text-align: right;">109</td>
<td style="text-align: left;">Tinamous</td>
<td style="text-align: left;">EC; in Paleognathae</td>
</tr>
<tr class="even">
<td style="text-align: left;">Anseriformes</td>
<td style="text-align: right;">111</td>
<td style="text-align: left;">Waterfowl</td>
<td style="text-align: left;">EC; in Galloanseres; sister to Galliformes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Galliformes</td>
<td style="text-align: right;">113</td>
<td style="text-align: left;">Landfowl</td>
<td style="text-align: left;">EC; in Galloanseres; sister to Anseriformes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Caprimulgiformes</td>
<td style="text-align: right;">115</td>
<td style="text-align: left;">Nightjars</td>
<td style="text-align: left;">EC; in Neoaves/Caprimulgiformae</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Steatornithiformes</td>
<td style="text-align: right;">117</td>
<td style="text-align: left;">Oilbird</td>
<td style="text-align: left;">EC; in Neoaves/Caprimulgiformae; monotypic</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nyctibiiformes</td>
<td style="text-align: right;">119</td>
<td style="text-align: left;">Potoos</td>
<td style="text-align: left;">EC; in Neoaves/Caprimulgiformae</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Limiting output.</strong> If you just want to see a few rows, include the keyword <code>LIMIT</code> and specify the number of rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return just 3 rows</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> orders <span class="kw">LIMIT</span> <span class="dv">3</span>; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>3 records</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 5%">
<col style="width: 16%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">order_ioc</th>
<th style="text-align: right;">seq</th>
<th style="text-align: left;">familiar_ioc</th>
<th style="text-align: left;">taxonomy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Struthioniformes</td>
<td style="text-align: right;">101</td>
<td style="text-align: left;">Ostriches</td>
<td style="text-align: left;">EC; in Paleognathae; ditypic</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rheiformes</td>
<td style="text-align: right;">103</td>
<td style="text-align: left;">Rheas</td>
<td style="text-align: left;">EC; in Paleognathae; ditypic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Apterygiformes</td>
<td style="text-align: right;">105</td>
<td style="text-align: left;">Kiwis</td>
<td style="text-align: left;">EC; in Paleognathae; sister to Casuariformes</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Specifying columns</strong> If you just want to see a subset of columns, replace <code>*</code> with the column name(s) separated by commas. SQL will return them in the order you specify.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return just two columns in a different order</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> seq, order_ioc <span class="kw">FROM</span> orders; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: right;">seq</th>
<th style="text-align: left;">order_ioc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">101</td>
<td style="text-align: left;">Struthioniformes</td>
</tr>
<tr class="even">
<td style="text-align: right;">103</td>
<td style="text-align: left;">Rheiformes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">105</td>
<td style="text-align: left;">Apterygiformes</td>
</tr>
<tr class="even">
<td style="text-align: right;">107</td>
<td style="text-align: left;">Casuariiformes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">109</td>
<td style="text-align: left;">Tinamiformes</td>
</tr>
<tr class="even">
<td style="text-align: right;">111</td>
<td style="text-align: left;">Anseriformes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">113</td>
<td style="text-align: left;">Galliformes</td>
</tr>
<tr class="even">
<td style="text-align: right;">115</td>
<td style="text-align: left;">Caprimulgiformes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">117</td>
<td style="text-align: left;">Steatornithiformes</td>
</tr>
<tr class="even">
<td style="text-align: right;">119</td>
<td style="text-align: left;">Nyctibiiformes</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Sorting output.</strong> An important feature of relational databases is that the rows (records) are not stored in a predictable or even stable order. This allows for faster filter and sort operations, but it does mean that you need to be explicit when you want results returned in a particular order.</p>
<p>To sort output, include <code>ORDER BY</code> and specify the column(s) to sort on. If you provide more than one column name, SQL will sort on the first column and then use the second column to break any ties, and so forth. To sort in reverse order, include <code>DESC</code> (short for descending).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return data sorted by one column in descending order</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> orders <span class="kw">ORDER</span> <span class="kw">BY</span> familiar_ioc <span class="kw">DESC</span>; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 3%">
<col style="width: 19%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">order_ioc</th>
<th style="text-align: right;">seq</th>
<th style="text-align: left;">familiar_ioc</th>
<th style="text-align: left;">taxonomy</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Piciformes</td>
<td style="text-align: right;">179</td>
<td style="text-align: left;">Woodpeckers and relatives</td>
<td style="text-align: left;">EC; in Telluraves/Afroaves; sister to Coraciiformes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Anseriformes</td>
<td style="text-align: right;">111</td>
<td style="text-align: left;">Waterfowl</td>
<td style="text-align: left;">EC; in Galloanseres; sister to Galliformes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Musophagiformes</td>
<td style="text-align: right;">127</td>
<td style="text-align: left;">Turacos</td>
<td style="text-align: left;">EC; in Neoaves/Cuculiformae; basal; sister to (Otidiformes + Cuculiformes)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Procellariiformes</td>
<td style="text-align: right;">155</td>
<td style="text-align: left;">Tube-nosed Seabirds</td>
<td style="text-align: left;">EC; in Neoaves/Aequornithae/Procellarimorphae; sister to Sphenisciformes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phaethontiformes</td>
<td style="text-align: right;">149</td>
<td style="text-align: left;">Tropicbirds</td>
<td style="text-align: left;">EC; in Neoaves; basal; sister to Eurypygiformes; tritypic</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trogoniformes</td>
<td style="text-align: right;">173</td>
<td style="text-align: left;">Trogons</td>
<td style="text-align: left;">EC; in Telluraves/Afroaves; sister to (Bucerotiformes + Coraciiformes + Piciformes)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tinamiformes</td>
<td style="text-align: right;">109</td>
<td style="text-align: left;">Tinamous</td>
<td style="text-align: left;">EC; in Paleognathae</td>
</tr>
<tr class="even">
<td style="text-align: left;">Apodiformes</td>
<td style="text-align: right;">123</td>
<td style="text-align: left;">Swifts and hummingbirds</td>
<td style="text-align: left;">EC; in Neoaves/Caprimulgiformae</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ciconiiformes</td>
<td style="text-align: right;">157</td>
<td style="text-align: left;">Storks</td>
<td style="text-align: left;">RC; in Neoaves/Aequornithae; ibises+Spoonbills removed</td>
</tr>
<tr class="even">
<td style="text-align: left;">Charadriiformes</td>
<td style="text-align: right;">145</td>
<td style="text-align: left;">Shorebirds and relatives</td>
<td style="text-align: left;">RC; in Neoaves; basal; Buttonquail added; isolated and diverse clade</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>LIMIT</code> and <code>ORDER BY</code> are examples of optional clauses in a <code>SELECT</code> statement. Clauses can be combined, but they need to be in a specific order. As we build increasingly complex <code>SELECT</code> statements, be sure to follow the order of clauses in the examples.</p>
<p>The following example combines all of the optional features we have covered so far.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return results in a customized way</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> seq, order_ioc <span class="kw">FROM</span> orders <span class="kw">ORDER</span> <span class="kw">BY</span> familiar_ioc <span class="kw">DESC</span> <span class="kw">LIMIT</span> <span class="dv">3</span>; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>3 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">seq</th>
<th style="text-align: left;">order_ioc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">179</td>
<td style="text-align: left;">Piciformes</td>
</tr>
<tr class="even">
<td style="text-align: right;">111</td>
<td style="text-align: left;">Anseriformes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">127</td>
<td style="text-align: left;">Musophagiformes</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>SQL syntax basics.</strong>. Before moving on, a couple of notes about SQL syntax:</p>
<ul>
<li><p>SQL commands are <em>case-insensitive</em>. However, the convention is to use upper-case for keywords, operators, and functions, and use to lower case for identifiers (table and column names). Writing your SQL code this way will make it more readable.</p></li>
<li><p>In contrast, search strings in SQL are generally <em>case-sensitive</em>, because case may matter in your data. The main exception is the <code>LIKE</code> operator (see below).</p></li>
<li><p>To insert a comment, start a line with <code>--</code> (double dash). You can also make the rest of a line a comment by inserting <code>--</code> after a command.</p></li>
<li><p>End each command with the <code>;</code> character.</p></li>
</ul>
</section>
<section id="conditions-in-queries" class="level2">
<h2 class="anchored" data-anchor-id="conditions-in-queries">Conditions in queries</h2>
<p>Often, we want to filter rows based on a condition. Include a <code>WHERE</code> clause to specify the condition you want to use for filtering.</p>
<p>Follow <code>WHERE</code> with the name of the column to apply the condition to, then the condition itself. To search for a match to a value, use the <code>=</code> operator. (Note the difference from R, which uses <code>==</code> in conditions.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the records for every species observed within a given genus</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> species <span class="kw">WHERE</span> genus_ioc <span class="op">=</span> <span class="st">'Bubo'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>4 records</caption>
<colgroup>
<col style="width: 5%">
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 10%">
<col style="width: 24%">
<col style="width: 17%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">seq</th>
<th style="text-align: left;">genus_ioc</th>
<th style="text-align: left;">species_ioc</th>
<th style="text-align: right;">num_spp</th>
<th style="text-align: left;">familiar_ioc</th>
<th style="text-align: left;">conservation</th>
<th style="text-align: left;">endemic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">726</td>
<td style="text-align: left;">Bubo</td>
<td style="text-align: left;">scandiacus</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Snowy Owl</td>
<td style="text-align: left;">LC</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">727</td>
<td style="text-align: left;">Bubo</td>
<td style="text-align: left;">virginianus</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">Great Horned Owl</td>
<td style="text-align: left;">LC</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">728</td>
<td style="text-align: left;">Bubo</td>
<td style="text-align: left;">cinarascens</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Greyish Eagle-Owl</td>
<td style="text-align: left;">LC</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">729</td>
<td style="text-align: left;">Bubo</td>
<td style="text-align: left;">africanus</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Spotted Eagle-Owl</td>
<td style="text-align: left;">LC</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When constructing a condition, logical, arithmetic, and set operators work as expected; Brackets can be used to indicate compound conditions. Conditions can be applied to a single column or to multiple columns using logical operators.</p>
<p>The examples below illustrate some of the ways to specify conditions for filtering.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the rows where a genus contains greater than 40 species</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> genus_ioc, num_sp <span class="kw">FROM</span> genera <span class="kw">WHERE</span> num_sp <span class="op">&gt;</span> <span class="dv">40</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus_ioc</th>
<th style="text-align: right;">num_sp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ducula</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Turdus</td>
<td style="text-align: right;">88</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ploceus</td>
<td style="text-align: right;">67</td>
</tr>
<tr class="even">
<td style="text-align: left;">Otus</td>
<td style="text-align: right;">57</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Scytalopus</td>
<td style="text-align: right;">44</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pachycephala</td>
<td style="text-align: right;">48</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rhipidura</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="even">
<td style="text-align: left;">Corvus</td>
<td style="text-align: right;">45</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phylloscopus</td>
<td style="text-align: right;">80</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cisticola</td>
<td style="text-align: right;">51</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return rows containing families with names that alphabetically follow a specified word</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> genus_ioc, family_ioc, num_sp <span class="kw">FROM</span> genera <span class="kw">WHERE</span> genus_ioc <span class="op">&gt;</span> <span class="st">'Vireo'</span> <span class="kw">ORDER</span> <span class="kw">BY</span> genus_ioc;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus_ioc</th>
<th style="text-align: left;">family_ioc</th>
<th style="text-align: right;">num_sp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Vireolanius</td>
<td style="text-align: left;">Vireonidae</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Volatinia</td>
<td style="text-align: left;">Thraupidae</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vultur</td>
<td style="text-align: left;">Cathartidae</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xenodacnis</td>
<td style="text-align: left;">Thraupidae</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Xenops</td>
<td style="text-align: left;">Furnariidae</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xiphocolaptes</td>
<td style="text-align: left;">Furnariidae</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Xiphorhynchus</td>
<td style="text-align: left;">Furnariidae</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">Zanda</td>
<td style="text-align: left;">Cacatuidae</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Zapornia</td>
<td style="text-align: left;">Rallidae</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">Zenaida</td>
<td style="text-align: left;">Columbidae</td>
<td style="text-align: right;">7</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return rows containing families that are part of a specified set</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> genus_ioc, familiar_genus <span class="kw">FROM</span> genera <span class="kw">WHERE</span> family_ioc <span class="kw">IN</span> (<span class="st">'Todidae'</span>, <span class="st">'Momotidae'</span>, <span class="st">'Meropidae'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>7 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus_ioc</th>
<th style="text-align: left;">familiar_genus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Merops</td>
<td style="text-align: left;">e(Merops Bee-eaters) p(Bee-eaters)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Momotus</td>
<td style="text-align: left;">e(Momotus Motmots) p(Motmots)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Todus</td>
<td style="text-align: left;">e(Todys)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Baryphthengus</td>
<td style="text-align: left;">e(Baryphthengus Motmots) p(Motmots)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Electron</td>
<td style="text-align: left;">e(Electron Motmots) p(Motmots)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Eumomota</td>
<td style="text-align: left;">e(Turquoise-browed Motmot) p(Motmots)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nyctyornis</td>
<td style="text-align: left;">e(Bearded Bee-eaters) p(Bee-eaters)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return rows containing families that contain more than 50 species and contain fewer than 10 genera</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> family_ioc, familiar_family, num_spp <span class="kw">FROM</span> families <span class="kw">WHERE</span> num_spp <span class="op">&gt;</span> <span class="dv">50</span> <span class="kw">AND</span> num_gen <span class="op">&lt;</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>7 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">family_ioc</th>
<th style="text-align: left;">familiar_family</th>
<th style="text-align: right;">num_spp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Grallariidae</td>
<td style="text-align: left;">Antpittas</td>
<td style="text-align: right;">68</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pachycephalidae</td>
<td style="text-align: left;">Whistlers and relatives</td>
<td style="text-align: right;">64</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vireonidae</td>
<td style="text-align: left;">Vireos and relatives</td>
<td style="text-align: right;">64</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rhipiduridae</td>
<td style="text-align: left;">Fantails and relatives</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phylloscopidae</td>
<td style="text-align: left;">Leaf Warblers</td>
<td style="text-align: right;">80</td>
</tr>
<tr class="even">
<td style="text-align: left;">Acrocephalidae</td>
<td style="text-align: left;">Reed Warblers and relatives</td>
<td style="text-align: right;">55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Motacillidae</td>
<td style="text-align: left;">Wagtails and Pipits</td>
<td style="text-align: right;">69</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>If you want to search a range of values, it is sometimes helpful to use the <code>BETWEEN</code> operator, which can work with strings and numbers. For strings, bear in mind that alphabetical sorting puts longer strings after shorter ones. Thus, if you only include one letter, no longer strings that begin with that letter will be returned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return rows with genus names that start with 'J', 'K' or 'L' </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> genus_ioc, familiar_genus <span class="kw">FROM</span> genera <span class="kw">WHERE</span> genus_ioc <span class="kw">BETWEEN</span> <span class="st">'J'</span> <span class="kw">AND</span> <span class="st">'L'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>6 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus_ioc</th>
<th style="text-align: left;">familiar_genus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Klais</td>
<td style="text-align: left;">m(Violet-headed Hummingbird)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jacana</td>
<td style="text-align: left;">e(New World Jacanas)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jabiru</td>
<td style="text-align: left;">m(Jabiru)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ketupa</td>
<td style="text-align: left;">e(Ketupa Owls)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kenopia</td>
<td style="text-align: left;">m(Striped Wren-babbler)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Junco</td>
<td style="text-align: left;">e(Juncos)</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Note the absence of any genera starting with “L”. Extend the range to “M” to return genera starting with “L”.</p>
<p>For numeric values, BETWEEN works exactly as you would expect it to.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return genera that contain between 28 and 29 species </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> genus_ioc, num_sp <span class="kw">FROM</span> genera <span class="kw">WHERE</span> num_sp <span class="kw">BETWEEN</span> <span class="dv">28</span> <span class="kw">AND</span> <span class="dv">30</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus_ioc</th>
<th style="text-align: right;">num_sp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Merops</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="even">
<td style="text-align: left;">Aerodramus</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Centropus</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="even">
<td style="text-align: left;">Treron</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Buteo</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="even">
<td style="text-align: left;">Glaucidium</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Todiramphus</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="even">
<td style="text-align: left;">Asthenes</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Thamnophilus</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lanius</td>
<td style="text-align: right;">29</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>To filter based on partial matches to strings, use the <code>LIKE</code> operator and the expansion character <code>%</code> to indicate “anything”. The expansion character can precede or follow the search sub-string (or both). Note that <code>LIKE</code> is unusual in that it is <em>not</em> case-sensitive; this is by design so that the search sub-string can occur at the beginning or middle of words.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return rows where family name starts with 'Str'</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> genus_ioc, familiar_genus <span class="kw">FROM</span> genera <span class="kw">WHERE</span> genus_ioc <span class="kw">LIKE</span> <span class="st">'Str%'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>5 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus_ioc</th>
<th style="text-align: left;">familiar_genus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Struthio</td>
<td style="text-align: left;">e(Ostriches)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Streptoprocne</td>
<td style="text-align: left;">e(Streptoprocne Swifts)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Streptopelia</td>
<td style="text-align: left;">e(Turtle and Collared Doves)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Strix</td>
<td style="text-align: left;">e(Strix Owls)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Strepera</td>
<td style="text-align: left;">e(Currawongs)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return rows where family name contains with 'colap'</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> genus_ioc, familiar_genus <span class="kw">FROM</span> genera <span class="kw">WHERE</span> genus_ioc <span class="kw">LIKE</span> <span class="st">'%colap%'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>6 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus_ioc</th>
<th style="text-align: left;">familiar_genus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Chrysocolaptes</td>
<td style="text-align: left;">e(Chrysocolaptes Flamebacks) p(Flamebacks)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Colaptes</td>
<td style="text-align: left;">e(Flickers and other Colaptes Woodpeckers)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dendrocolaptes</td>
<td style="text-align: left;">e(Dendrocolaptes Woodcreepers) p(Woodcreepers)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Xiphocolaptes</td>
<td style="text-align: left;">e(Xyphocolaptes Woodcreepers) p(Woodcreepers)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lepidocolaptes</td>
<td style="text-align: left;">e(Lepidocolaptes Woodcreepers) p(Woodcreepers)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pseudocolaptes</td>
<td style="text-align: left;">e(Tuftedcheeks)</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="summarizing-and-grouping-data" class="level2">
<h2 class="anchored" data-anchor-id="summarizing-and-grouping-data">Summarizing and grouping data</h2>
<p>SQL offers powerful summarizing and grouping capabilities that have inspired packages in other languages (<code>dplyr</code> is designed to replicate some SQL functionality). We will explore summarzing and grouping using a single table for simplicity, but bear in mind that these operations can also be applied to the output of multi-table queries, such as those covered in later sections of this notebook.</p>
<p>You can quickly get basic information about a numeric column using summary functions: <code>MIN</code>, <code>MAX</code>, <code>SUM</code>, and <code>AVG</code>. SQL functions work similarly to those in R: indicate what you want to pass to the function by enclosing in round brackets.</p>
<p>Note that SQL automatically assigns a column name for values that it computes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the largest number of genera in a single family</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(num_gen) <span class="kw">FROM</span> families;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">AVG(num_gen)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">9.277778</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>To see which family contains the most genera, include the column name with the summary function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the largest number of genera in a single family and the name of that family</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> family_ioc, <span class="fu">MAX</span>(num_gen) <span class="kw">FROM</span> families;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">family_ioc</th>
<th style="text-align: right;">MAX(num_gen)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Trochilidae</td>
<td style="text-align: right;">112</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>MIN</code> and <code>MAX</code> also work with character values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the first and last genus in alphabetical order</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">MIN</span>(genus_ioc), <span class="fu">MAX</span>(genus_ioc) <span class="kw">FROM</span> genera;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">MIN(genus_ioc)</th>
<th style="text-align: left;">MAX(genus_ioc)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Abroscopus</td>
<td style="text-align: left;">Zosterops</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>A surprisingly useful SQL function is <code>COUNT.</code> Use can use count to learn how many records (rows) are in a table</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the number of records in the families table</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FROM</span> families;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">COUNT(*)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">252</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>or the number of rows that match a particular condition.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the number of families that start with the letter "M"</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FROM</span> families <span class="kw">WHERE</span> family_ioc <span class="kw">LIKE</span> <span class="ot">"M%"</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: right;">COUNT(*)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">22</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>To aggregate rows by value, use a <code>GROUP BY</code> clause and specify column or columns to use. This clause follows the <code>FROM</code> or <code>WHERE</code> clause (if present) and precedes <code>ORDER BY</code> and <code>LIMIT</code> clauses (if present).</p>
<p>The following query returns the top 10 locations with the most observations in the database. It groups by location name, tallies the number of observations at each location using the <code>COUNT</code> function, and then sorts in descending order and limits the return to 10 records.</p>
<p>As queries become more complex, it is common to use multiple lines and indenting to improve readability.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the number of records at each location</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  location_name,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  observations</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  location_name</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>() <span class="kw">DESC</span>           <span class="co">-- just the top 10 locations</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">location_name</th>
<th style="text-align: right;">COUNT(*)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">La Selva</td>
<td style="text-align: right;">909</td>
</tr>
<tr class="even">
<td style="text-align: left;">Duke University</td>
<td style="text-align: right;">378</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Serengeti NP</td>
<td style="text-align: right;">232</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phinda PGR</td>
<td style="text-align: right;">210</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bellavista</td>
<td style="text-align: right;">182</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fiskebackskil</td>
<td style="text-align: right;">166</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tarangire NP</td>
<td style="text-align: right;">164</td>
</tr>
<tr class="even">
<td style="text-align: left;">Las Cruces</td>
<td style="text-align: right;">159</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Palo Verde</td>
<td style="text-align: right;">148</td>
</tr>
<tr class="even">
<td style="text-align: left;">Luna Lodge</td>
<td style="text-align: right;">142</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Another useful function is <code>DISTINCT.</code> Use it to return the number of unique entries in a column. <code>DISTINCT</code> can be combined with <code>COUNT</code> and <code>GROUP BY</code> for powerful summarizing queries.</p>
<p>The example nests <code>DISTINCT</code> within <code>COUNT</code> to return the number of unique locations. The WHERE clause uses AND to create a compound condition that narrows the filtering to one species.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- returns the number of locations where a given species has been observed</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  genus_ioc,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  species_ioc,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> (location_name))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  observations</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  genus_ioc <span class="op">=</span> <span class="st">'Falco'</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">AND</span> species_ioc <span class="op">=</span> <span class="st">'tinnunculus'</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  genus_ioc,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  species_ioc;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus_ioc</th>
<th style="text-align: left;">species_ioc</th>
<th style="text-align: right;">COUNT(DISTINCT (location_name))</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Falco</td>
<td style="text-align: left;">tinnunculus</td>
<td style="text-align: right;">19</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="aliases" class="level2">
<h2 class="anchored" data-anchor-id="aliases">Aliases</h2>
<p>Looking at the results of the queries in the previous section, it’s clear that the column labels that SQL assigns automatically are not ideal. Using more intuitive labels makes output easier to interpret. To do this, we can assign an <em>alias</em> using the keyword <code>AS</code> followed by a name. Aliases without any spaces do not need quotes.</p>
<p>A second important use for aliases is to simplify table names. We will see examples later, when we get to queries that involve multiple tables.</p>
<p>Note that aliases are not saved in memory; they apply only to the current query.</p>
<p>The following query returns the number of species that have been observed within each genus, and sorts them in reverse order. SQL will use the two alias in the SELECT clause as column headers in the output. Note that any alias introduced in the <code>SELECT</code> clause must also appear in the <code>ORDER BY</code> clause. Also note the location of the DESC keyword (try placing it after genus and see what happens).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the number of species observed within each genus ranked by number observed</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  genus_ioc <span class="kw">AS</span> genus,           <span class="co">-- define the aliases here and next line</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> species_seen</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  species</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  genus_ioc</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  species_seen <span class="kw">DESC</span>,            <span class="co">-- use the aliases here and next line</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  genus</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus</th>
<th style="text-align: right;">species_seen</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Turdus</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: left;">Setophaga</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Corvus</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">Larus</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ploceus</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Anas</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pycnonotus</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lanius</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phylloscopus</td>
<td style="text-align: right;">14</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Another helpful way to label output is to use the function <code>CONCAT</code> to create strings that can be assigned to an alias. Strings can contain a mix of column values and whatever you provide. Enclose your text in quotes and separate items with commas.</p>
<p>With the current database, genus and species names are stored separately, so <code>CONCAT</code> is particularly useful for combining them into a single column when returning the results of a query.</p>
<p>The following query returns the date on which each species was first observed. It uses <code>CONCAT</code> to create a column header by joining the genus and species names, separated by a space for readability. Also note that the second alias requires quotes because it contains a space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- returns the first observation of each species in a given genus and labels the output</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">CONCAT</span>(genus_ioc, <span class="st">' '</span>, species_ioc) <span class="kw">AS</span> species,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">MIN</span>(date_obs) <span class="kw">AS</span> <span class="st">'first seen'</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  observations</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  genus_ioc <span class="op">=</span> <span class="st">'Falco'</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  genus_ioc,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  species_ioc</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: left;">first seen</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Falco amurensis</td>
<td style="text-align: left;">2019-09-23</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco ardosiaceus</td>
<td style="text-align: left;">2007-06-24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Falco biarmicus</td>
<td style="text-align: left;">2007-06-18</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco cenchroides</td>
<td style="text-align: left;">2019-05-20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Falco chicquera</td>
<td style="text-align: left;">2013-06-13</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco columbarius</td>
<td style="text-align: left;">2014-02-01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Falco eleonorae</td>
<td style="text-align: left;">2015-07-20</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco longipennis</td>
<td style="text-align: left;">2009-01-04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Falco naumanni</td>
<td style="text-align: left;">2017-06-14</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco peregrinus</td>
<td style="text-align: left;">1996-07-22</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>By combining aliases and grouping functions, it is possible to create reports that summarize several different kinds of information.</p>
<p>Building on the previous query, the query below asks for additional details about the first sightings to provide additional context.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- returns the first observation of each species within a given genus with additional context</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">CONCAT</span> (genus_ioc, <span class="st">' '</span>, species_ioc) <span class="kw">AS</span> species,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(seq) <span class="kw">AS</span> <span class="st">'# sightings'</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">MIN</span>(date_obs) <span class="kw">AS</span> <span class="st">'first seen'</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">MAX</span>(date_obs) <span class="kw">AS</span> <span class="st">'last seen'</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> (location_name)) <span class="kw">AS</span> <span class="st">'# places'</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> (subspecies_ioc)) <span class="kw">AS</span> <span class="st">'# subspecies'</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  observations</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  genus_ioc <span class="op">=</span> <span class="st">'Falco'</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  genus_ioc,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  species_ioc;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<colgroup>
<col style="width: 24%">
<col style="width: 16%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: right;"># sightings</th>
<th style="text-align: left;">first seen</th>
<th style="text-align: left;">last seen</th>
<th style="text-align: right;"># places</th>
<th style="text-align: right;"># subspecies</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Falco amurensis</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2019-09-23</td>
<td style="text-align: left;">2019-09-23</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco ardosiaceus</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2007-06-24</td>
<td style="text-align: left;">2017-10-03</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Falco biarmicus</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">2007-06-18</td>
<td style="text-align: left;">2019-07-24</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco cenchroides</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2019-05-20</td>
<td style="text-align: left;">2019-05-20</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Falco chicquera</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2013-06-13</td>
<td style="text-align: left;">2013-06-13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco columbarius</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">2014-02-01</td>
<td style="text-align: left;">2023-12-24</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Falco eleonorae</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2015-07-20</td>
<td style="text-align: left;">2015-07-20</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco longipennis</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">2009-01-04</td>
<td style="text-align: left;">2009-01-04</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Falco naumanni</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">2017-06-14</td>
<td style="text-align: left;">2017-06-22</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Falco peregrinus</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">1996-07-22</td>
<td style="text-align: left;">2023-05-17</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="nested-queries" class="level2">
<h2 class="anchored" data-anchor-id="nested-queries">Nested queries</h2>
<p>Nested queries are useful when we want to first narrow a search, then query the results in a different way. The two queries With nested queries, the “inner” query is executed first, followed by a second “outer” query that only considers the rows returned by the first query.</p>
<p>The inner query is embedded within a <code>WHERE</code> clause in the outer query, which uses the <code>IN</code> operator to test for membership in the results of the inner query. Importantly, the two queries can access information in different tables. There is no limit on nesting in queries, but best practice is to limit nesting to 2 or 3 levels; there are better ways to deal with highly complex queries than deep nesting.</p>
<p>Nested queries are particularly useful in this database, because the taxonomic tables represent nested taxa.</p>
<p>The query below returns the name of every species that has been observed within a given family. This information is stored in multiple tables: the <code>genera</code> table has a column that assigns every genus to a family. It first queries the <code>genera</code> table to retrieve a list of all genera in the family of interest. Next, it queries the <code>species</code> table to retrieve the genus and species names of every entry in the list returned by the first query.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the names of all species observed in a given family</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="co">-- this SELECT returns rows that match the set returned by the nested query</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">CONCAT</span> (genus_ioc, <span class="st">' '</span>, species_ioc) <span class="kw">AS</span> species,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  familiar_ioc <span class="kw">AS</span> <span class="st">'common name'</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  species</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  genus_ioc <span class="kw">IN</span> (</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> genus_ioc                   <span class="co">-- beginning of the nested query (executes first)</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> genera</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> family_ioc <span class="op">=</span> <span class="st">'Lybiidae'</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ORDER</span> <span class="kw">BY</span> seq</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  )                                    <span class="co">-- end of the nested query</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  genus_ioc,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  species_ioc,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  familiar_ioc</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  genus_ioc,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  species_ioc</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">species</th>
<th style="text-align: left;">common name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Buccanodon duchaillui</td>
<td style="text-align: left;">Yellow-spotted Barbet</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gymnobucco bonapartei</td>
<td style="text-align: left;">Grey-throated Barbet</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lybius bidentatus</td>
<td style="text-align: left;">Double-toothed Barbet</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lybius leucocephalus</td>
<td style="text-align: left;">White-headed Barbet</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lybius torquatus</td>
<td style="text-align: left;">Black-collared Barbet</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pogoniulus bilineatus</td>
<td style="text-align: left;">Yellow-rumped Tinkerbird</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pogoniulus pusillus</td>
<td style="text-align: left;">Red-fronted Tinkerbird</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trachyphonus darnaudii</td>
<td style="text-align: left;">D’Arnaud’s Barbet</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trachyphonus erythrocephalus</td>
<td style="text-align: left;">Red-and-yellow Barbet</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trachyphonus usambiro</td>
<td style="text-align: left;">Usambiro Barbet</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Nested queries can also be useful for tabulating counts from multiple tables into a single report. To do this, use <code>SELECT</code> as a “wrapper” for multiple nested queries.</p>
<p>The query below demonstrates the use of <code>SELECT</code> as a wrapper to generate a report. Note that there is no table name in the outer query. Second, it demonstrates how to access a built-in variable using <code>SELECT</code>. Retrieving the value of DATE provides a date stamp on the output. If we want to save this output, we now have a record of when the query was made.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- comment</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- return the number of species observed and the total number recognized</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">SELECT</span> <span class="dt">DATE</span>()) <span class="kw">AS</span> <span class="st">'as of'</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">FROM</span> species) <span class="kw">AS</span> <span class="st">'species observed'</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">SELECT</span> <span class="fu">SUM</span>(num_spp) <span class="kw">FROM</span> families) <span class="kw">AS</span> <span class="st">'out of a total of'</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>1 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">as of</th>
<th style="text-align: right;">species observed</th>
<th style="text-align: right;">out of a total of</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2024-11-10</td>
<td style="text-align: right;">2327</td>
<td style="text-align: right;">10912</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="joins" class="level3">
<h3 class="anchored" data-anchor-id="joins">Joins</h3>
<p>The real power of SQL is its ability to query data from multiple tables at once using (relatively) simple statements. This can be done by including a <code>JOIN</code> clause that specifies how to merge results and specifies one or more relations that link one or more columns between two or more tables.</p>
<p>The most commmon kind of join is a left join, where every row from the first table is returned, attached to any row from the second table where a value matches a row in the relation column(s) of the first table. If there is no match in the second table, NULL values will be inserted. Left joins allow for a one-to-many relationship between rows in the first table to those in the second table: a row from the first table might appear multiple times if more than one row in the second table contains matching values in the related column.</p>
<p>Left joins are perfect for the taxonomic tables in the database, which have an inherently nested structure: every higher taxon contains at least one lower taxon. Left joins are also useful for the <code>observations</code> table, where multiple records may be related to a single species or trip or location.</p>
<p>It is often the case that the same column name appears in multiple tables within a relational database. To make explicit which column of the same name you wish to reference, simply append the table name and a <code>.</code> (dot) before the column name. Columns specified in this way are said to be <strong>fully qualified</strong>. When writing queries that involve multiple tables, you only need to fully qualify if a column name exists in more than one table. However, fully qualifying is always allowed even when not needed, and doing so can make the logic of a query clearer.</p>
<p>When dealing with multiple tables, using aliases for table names can help to simplify a query. A common convention is to use a single letters corresponding the table’s full name.</p>
<p>Most versions of SQL accept more than one syntax for indicating a join. We’ll use the newer and recommended syntax, but be aware that other ways to specify joins exist and are commonly used. Also be aware that it is possible (but not recommended) to create implicit joins by leaving out the JOIN keyword and simply specifying one or more relations in a WHERE clause. This produces a cross join, which can work in simple queries but is often not what you actually want. You will likely encounter both alternative approaches if you refer to code from ChatGPT or StackOverflow. Best practice is to always use explicit joins and the syntax introduced below.</p>
<p>The query below returns the scientific and common names of every observed species in a given family. The information needed to do this resides in two different tables: <code>species</code> and <code>genera</code>. The query left joins the genera table onto the species table, providing information about which family that species belongs to. It then filters by family name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- returns a list of all observed species from a given family</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  species.genus_ioc <span class="kw">AS</span> genus, </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  species.species_ioc <span class="kw">AS</span> species,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  species.familiar_ioc <span class="kw">AS</span> <span class="st">'common name'</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> species</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">LEFT</span> <span class="kw">JOIN</span> genera </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> species.genus_ioc <span class="op">=</span> genera.genus_ioc</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  genera.family_ioc <span class="op">=</span> <span class="st">'Caprimulgidae'</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  genera.seq</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">20</span>;</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>6 records</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus</th>
<th style="text-align: left;">species</th>
<th style="text-align: left;">common name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Chordeiles</td>
<td style="text-align: left;">minor</td>
<td style="text-align: left;">Common Nighthawk</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chordeiles</td>
<td style="text-align: left;">rupestris</td>
<td style="text-align: left;">Sand-colored Nighthawk</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nyctidromus</td>
<td style="text-align: left;">albicollis</td>
<td style="text-align: left;">Pauraque</td>
</tr>
<tr class="even">
<td style="text-align: left;">Antrostomus</td>
<td style="text-align: left;">rufus</td>
<td style="text-align: left;">Rufous Nightjar</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Caprimulgus</td>
<td style="text-align: left;">clarus</td>
<td style="text-align: left;">Slender-tailed Nightjar</td>
</tr>
<tr class="even">
<td style="text-align: left;">Caprimulgus</td>
<td style="text-align: left;">pectoralis</td>
<td style="text-align: left;">Fiery-necked Nightjar</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The next query reports how many species have been observed from each genus relative to the total. It joins the genus and species tables and returns three numbers, each derived in a different way: (1) a tally of the number of species observed, using GROUP BY and the COUNT function; (2) the total number of species in that genus, read directly from the genus.num_spp column; and (3) a computed value (yes, you can do math with SQL!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- returns the proportion of species observed within each genus</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  species.genus_ioc <span class="kw">AS</span> genus,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">COUNT</span>(species_ioc) <span class="kw">AS</span> <span class="st">'recorded species'</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  genera.num_sp <span class="kw">AS</span> <span class="st">'total species'</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ROUND</span>(((<span class="fu">COUNT</span>(species_ioc) <span class="op">+</span> <span class="fl">0.0</span>) <span class="op">/</span> genera.num_sp), <span class="dv">3</span>) <span class="op">*</span> <span class="dv">100</span> <span class="kw">AS</span> <span class="st">'percent recorded'</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> species</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">LEFT</span> <span class="kw">JOIN</span> genera </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">ON</span> species.genus_ioc <span class="op">=</span> genera.genus_ioc</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  genera.seq,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  species.genus_ioc,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  genera.num_sp</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  genera.seq</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  ;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Displaying records 1 - 10</caption>
<thead>
<tr class="header">
<th style="text-align: left;">genus</th>
<th style="text-align: right;">recorded species</th>
<th style="text-align: right;">total species</th>
<th style="text-align: right;">percent recorded</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Struthio</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">50.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tinamus</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">20.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Crypturellus</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">9.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Anhima</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Anseranas</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dendrocygna</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">62.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Branta</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">66.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Anser</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">45.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cygnus</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">50.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Merganetta</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">100.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>